---
import Layout from "../layouts/Layout.astro";
import HeroSection from "../components/sections/HeroSection.astro";
import ProjectsSection from "../components/sections/ProjectsSection.astro";
import ContactForm from "../components/ContactForm.astro";
import { loaderAnimation } from "../lib/constants";
import { initializeCardAnimations } from "../utils/animations";
import { setupLanguageChangeListener, updateTranslations } from "../utils/translationsSetup";
import { setupContactFormListeners } from "../utils/contactFormSetup";

const currentLang = Astro.cookies.get('language')?.value || 'fr';
---

<script define:vars={{ loaderAnimation }}>
  import { initializeCardAnimations } from "../utils/animations";
  import { setupLanguageChangeListener, updateTranslations } from "../utils/translationsSetup";
  import { setupContactFormListeners } from "../utils/contactFormSetup";

  // Initialize animations
  try {
    initializeCardAnimations(loaderAnimation);
  } catch (error) {
    console.error('Error initializing card animations:', error);
    // Fallback: hide loader if animation fails
    const loader = document.querySelector('.loader');
    if (loader) {
      loader.style.opacity = '0';
      loader.style.pointerEvents = 'none';
    }
  }

  // Setup listeners
  setupLanguageChangeListener();
  setupContactFormListeners();

  // Initial update
  document.addEventListener('astro:page-load', () => {
    const lang = document.documentElement.lang || 'fr';
    updateTranslations(lang);
  });

  // Fallback: ensure loader is hidden after 3 seconds
  setTimeout(() => {
    const loader = document.querySelector('.loader');
    if (loader) {
      loader.style.opacity = '0';
      loader.style.pointerEvents = 'none';
    }
  }, 3000);
</script>

<Layout
  title="Judicael TO | Computer science student"
  description="Computer science student with strong interest in web development, software engineering and data science. I am passionate about learning new technologies and sharing knowledge."
>
  <main class="text-white relative w-full overflow-hidden">
    <HeroSection />
    <ProjectsSection />
  </main>
  
  <ContactForm />
</Layout>
